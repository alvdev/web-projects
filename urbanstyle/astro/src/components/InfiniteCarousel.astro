---
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";
import { getCollection } from "astro:content";

const {
    folder = "carousel",
    direction = "right",
    speed = "normal",
    itemsWidth = 320,
    itemsHeight = 180,
    gap = "2rem",
} = Astro.props;

const collection = await getCollection("carousel", (item: any) => item.id.includes(`/${folder}/`));
const { enabledTitles, title, subtitle, description, images } = collection[0].data;
const normalizedScrollDirection = direction === "right" ? "r" : direction === "left" ? "l" : direction;

const getDuration = (duration: "slow" | "normal" | "fast") => {
    switch (duration) {
        case "slow":
            return `${8 * images.length}s`;
        case "normal":
            return `${4 * images.length}s`;
        case "fast":
            return `${2 * images.length}s`;
        default:
            return duration;
    }
};
const normalizedAnimationDuration = `animation-duration: ${getDuration(speed)}`;
---

<section class="infinite-scroll-h mt-36">
    {
        enabledTitles && (
            <>
                <hgroup class="container mb-4">
                    {title && (
                        <h2 class="font-semibold md:!leading-tight m-0 text-2xl md:text-3xl lg:text-4xl">{title}</h2>
                    )}
                    {subtitle && <h3>{subtitle}</h3>}
                </hgroup>

                {description && <p class="container mb-8 text-gray-500">{description}</p>}
            </>
        )
    }

    <div class="relative px-0 ring-0 shadow-none box-shadow-[0px_0px_0px_0px_rgba(0,0,20px,0.5)] overflow-x-clip">
        <div
            class={`carousel-track flex w-max animate-infinite-scroll-${normalizedScrollDirection} hover:animate-pause`}
            style={`${normalizedAnimationDuration}; gap: ${gap}`}
        >
            {
                /* Duplicate set of images */
                [...images, ...images].map(img => (
                    <div class="w-full f-full rounded-sm border-2 shadow-lg">
                        <figure>
                            <Image
                                src={img.src as ImageMetadata}
                                alt={img.alt}
                                width={itemsWidth}
                                height={itemsHeight}
                                format="avif"
                                class="max-w-none brightness-125 saturate-110 contrast-110 w-full shadow-xl"
                            />
                            {img.desc && (
                                <figcaption class="border border-black  mx-auto px-4 py-2 text-sm bg-black text-white relative">
                                    {img.desc}
                                </figcaption>
                            )}
                        </figure>
                    </div>
                ))
            }
        </div>
    </div>
</section>

<style>
    @keyframes infinite-scroll-l {
        from {
            transform: translateX(0%);
        }

        to {
            transform: translateX(-50%);
        }
    }

    .animate-infinite-scroll-l {
        animation: infinite-scroll-l 30s linear infinite;
    }

    @keyframes infinite-scroll-r {
        from {
            transform: translateX(-50%);
        }

        to {
            transform: translateX(0%);
        }
    }

    .animate-infinite-scroll-r {
        animation-name: infinite-scroll-r;
        animation-timing-function: linear;
        animation-iteration-count: infinite;
    }
</style>
