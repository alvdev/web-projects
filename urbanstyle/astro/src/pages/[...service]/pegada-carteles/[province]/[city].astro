---
import { provinces } from "@/data/provinces";
import { citiesByProvince } from "@/data/cities";
import LandingPegadaCarteles from "@/components/LandingPegadaCarteles.astro";
import Header from "@/components/Header.astro";
import actions from "@/assets/images/landings/acciones-marketing-local.webp";
import Layout from "@/layouts/Base.astro";

export async function getStaticPaths() {
    const images = import.meta.glob("/src/assets/images/landings/cities/**/*.{jpg,jpeg,png,webp}");

    const allRoutes = provinces.flatMap(province => {
        const cities = citiesByProvince[province.slug] || [];
        return cities.filter(city => city.slug !== province.slug).map(city => ({ province, city }));
    });

    return Promise.all(
        allRoutes.map(async ({ province, city }) => {
            let cover = actions;
            if (city.cover && images[city.cover]) {
                const imageModule = (await images[city.cover]()) as any;
                cover = imageModule.default;
            }

            return {
                params: {
                    service: undefined,
                    province: province.slug,
                    city: city.slug,
                },
                props: { city, cover },
            };
        }),
    );
}

const { city, cover } = Astro.props;
---

<Layout
    title={`Pegada de carteles en ${city.name} | Urban Style`}
    description={`Servicio profesional de pegada de carteles en ${city.name}. ${city.title}`}
>
    <Header
        title={`Pegada de carteles en ${city.name}`}
        cover={cover}
        coverAlt={`Fotografía panorámica de la ciudad de ${city.name}`}
        loading="eager"
        classes="*:[img]:top-0"
    />
    <main class="relative z-10 pb-6 pt-28">
        <LandingPegadaCarteles city={city} />
    </main>
</Layout>
