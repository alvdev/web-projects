---
import { provinces } from "@/data/provinces";
import { citiesByProvince } from "@/data/cities";
import LandingPegadaCarteles from "@/components/LandingPegadaCarteles.astro";
import Header from "@/components/Header.astro";
import defaultCover from "@/assets/images/landings/acciones-marketing-local.webp";
import Layout from "@/layouts/Base.astro";

export async function getStaticPaths() {
    const images = import.meta.glob("/src/assets/images/landings/cities/**/*.{jpg,jpeg,png,webp}");

    return Promise.all(
        provinces.map(async province => {
            const cities = citiesByProvince[province.slug] || [];
            const cityData = cities.find(c => c.slug === province.slug) || province;

            let cover = defaultCover;
            if (cityData.cover && images[cityData.cover]) {
                const imageModule = (await images[cityData.cover]()) as any;
                cover = imageModule.default;
            }

            return {
                params: {
                    service: undefined,
                    province: province.slug,
                },
                props: { city: cityData, cover },
            };
        }),
    );
}

const { city, cover } = Astro.props;
---

<Layout
    title={`Pegada de carteles en ${city.name} | Urban Style`}
    description={`Servicio profesional de pegada de carteles en ${city.name}. ${city.title}`}
>
    <Header
        title={`Pegada de carteles en ${city.name}`}
        cover={cover}
        coverAlt={`Fotografía panorámica de la ciudad de ${city.name}`}
        loading="eager"
        classes="*:[img]:-top-36 md:*:[img]:-top-12 xl:*:[img]:-top-36"
    />

    <main class="relative z-10 pb-6 pt-28">
        <LandingPegadaCarteles city={city} />
    </main>
</Layout>
